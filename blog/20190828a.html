<!doctype html><html lang=en><link href=data:, rel=icon><title>Liam Timms - 28/08/2019: Firefox 69 now fully depends on dbus</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1.0"><style>body{display:flex;flex-direction:column;font:16px/1.6 sans-serif;margin:0;min-height:100vh;overflow:hidden scroll;word-wrap:break-word}h1,h2,h3{margin-top:40px}main{flex:1;width:90%}pre>code,main,#m{display:block;margin:10px auto 40px;max-width:52ch;padding:0 10px}pre>code{background:#000;color:#eee;font-family:Consolas,monospace;font-weight:normal;padding:20px;white-space:pre-wrap;max-width:100%;margin:0 0 40px}code{background:#fcc;border-radius:4px;font-weight:700;padding:.1em .4em}nav li{display:inline-block;line-height:2.5;margin:0 20px 0 0}blockquote{border-left:7px solid #fc9;color:#333;margin:0;padding:0 14px}img{display:block;left:50%;max-width:50vw;min-width:100%;padding:0 0 1em;position:relative;transform:translateX(-50%)}nav,footer{background:#000;padding:30px}nav a,footer{color:#eee}#a{color:#f06}a{color:#00C;text-decoration:none}a:hover{border-bottom:2px solid}ul{padding-left:2em}nav ul{margin:0;text-align:center}li+li{margin-top:4px}li>ul{margin:5px 0 15px}</style><nav><ul><li><a href=/pages/projects/><b>Research</b></a><li><a href=/blog/>Blog</a><li><a href=/pages/team/>Team</a><li><a href=/pages/projects>Software</a><li><a href=https://github.com/liamtimms/>GitHub</a><li><a href=/pages/contact/>Contact</a><li><a href=/pages/donate/>Donate</a></ul></nav><main><h1>28/08/2019: Firefox 69 now fully depends on dbus</h1><p>The upcoming Firefox release now depends on <code>dbus</code> and this dependency can’t be disabled. The usual <code>--disable-dbus</code> option has no effect.</p><p>Until this is fixed upstream or we find a way to patch this out KISS will be swapping to the next ESR release of Firefox (68.0.2 -&gt; 68.1.0). This gives us a little over a year to sort out this situation.</p><p>With the release of Firefox 70 ALSA support will also be dropped from Firefox and we will have to ship <code>apulse</code> with KISS to fix this.*</p><p>It seems to be getting harder and harder to run and maintain a system which doesn’t follow the usual trend of software choices. Firefox even has a <code>dbus</code> dependency on FreeBSD and OpenBSD!</p><p>The upstream bug report can be found here: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1561207">#1561207</a></p><p>*: Update: On inspection of the Firefox 71 beta, ALSA is still supported!</p><h2 id="update-nov-3-2019">Update (<em>Nov 3 2019</em>)</h2><p>I have written a patch to remove the <code>dbus</code> requirement in versions <strong>69.0</strong> to <strong>71.0</strong> beta. Firefox in KISS works 100% fine <em>without</em><code>dbus</code>!</p><ul><li>Firefox 71.0 beta: <a href="https://github.com/kisslinux/repo/blob/ded0a8fc3e2800a579a2ed7df850e619a113c8eb/testing/firefox/patches/firefox-71-no-dbus.patch">patch</a></li><li>Firefox 70.0: <a href="https://github.com/kisslinux/repo/blob/a71e02ef014d044ab3e8c0938003b4183c3e26fc/extra/firefox/patches/firefox-70-no-dbus.patch">patch</a></li><li>Firefox 69.0.2: <a href="https://github.com/kisslinux/repo/blob/a7e7f001cd829f9e177fc93959dfcdd0d6749014/extra/firefox/patches/firefox-69.0.2-no-dbus.patch">patch</a></li><li>Firefox 69.0: <a href="https://github.com/kisslinux/repo/blob/aa24ba44e318f5fbb85eea5fe14c908b24cab6fb/extra/firefox/patches/firefox-69-no-dbus.patch">patch</a></li></ul><h3 id="why-did-disable-dbus-break">Why did –disable-dbus break?</h3><p>Firefox 69.0 added a new audio feature called “audio_thread_priority” to prioritize audio threads. On Linux, this uses <code>dbus</code> to function.</p><p>Firefox has historically always provided the <code>--disable-dbus</code> option to remove the requirement. It has always been optional. The feature works in its entirety <strong>minus</strong> the new <code>audio_thread_priority</code> code.</p><p>No (<em>or little</em>) testing was done with the <code>--disable-dbus</code> configure flag and this is marked as a <strong>defect</strong> in the upstream bug report (<em>which gives me hope that it’ll be fixed</em>).</p><p>My patch to workaround this issue simply disables the <code>audio_thread_priority</code> feature which removes the <code>dbus</code> requirement and effectively reverts audio to how it was prior to version 69.0.</p><p>The upstream bug report can be found here: <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1561207">#1561207</a></p><br><pre></pre></main><footer><div id=m><p>Liam Timms 2019</p></div></footer>
